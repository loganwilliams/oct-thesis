\chapter{System design}

In this chapter, the major components of the fiber optic Doppler optical coherence microscopy (FO-DOCM) system will be introduced, and the constraints that led to their choice will be examined. The mechanical and optical design will be detailed. Finally, predictions of system performance will be made based on component choices.

\section{System overview}

\begin{figure}[h!]
\centering
\includegraphics[width=1.0\textwidth]{Images/Background/actual_system_vertical.png}
\caption{Block diagram of the FO-DOCM system.}
\end{figure}

\subsection{Incoherent light source}

The choice of a light source dictates many aspects of the system performance. The coherence length, as shown in Section~\ref{sec:principles_oct}, controls the axial resolution of the imaging. The center wavelength of the source constrains the tissue penetration depth, and what other components may be used in the system.

For this project,  a super-luminescent diode, or SLD, was chosen (Exalos AG, Switzerland, Part No: EXS210045-01). Super luminescent diodes provide the spatial coherence of a laser with the short temporal coherence of an LED or ``white'' light source. Other common broadband light sources for OCT applications include solid-state lasers, such as Ti: Al$_2$O$_3$ lasers, lasers that sweep a frequency range in time (so called ``swept-spectrum'' lasers), and femtosecond lasers. The chief advantage of an SLD over these options is reduced cost and complexity \cite{bouma}.

A center wavelength of 1310 nm was chosen as this is a common wavelength for communications. It is therefore possible to find many inexpensive fiber coupled components designed to operate in this band. Additionally, as discussed in Section \ref{sec:intro}, a longer wavelength could allow for deeper penetration through the bony cochlear wall \cite{Sandell2011} \cite{Bashkatov2006}.

An optical isolator is required after the SLD in order to prevent back reflections from resonating and adversely impacting the spectral width of the source.

% \begin{table}[h!]
% \centering
% \begin{tabular}{ >{\bf}r | l}
% Part number & Exalos EXS210045-01 \\
% Center wavelength & 1310 nm \\
% FWHM Bandwidth & 100 nm \\
% Coherence length & 7.57 $\mu$m \\
% Power & 10 mW \\
% Price & \$1800, \$900 driver \\
% \end{tabular}
% \caption{Specifications for the optical source.}
% \end{table} 

\subsection{Acousto-optic modulators}

Two fiber coupled acousto-optic modulators (Gooch \& Housego, United Kingdom; packaged by Sintec Optronics, Singapore. Part No: 23080-1-1.3-LTD-FC/APC) were chosen, which provide a convenient, compact device and avoid the need for alignment with the first degree deflection beam required in free space optics. An 80 MHz drive frequency was chosen for compatibility with existing hardware used in the Micromechanics Group. %Detailed specifications for this device are shown in Table 2.2.

% \begin{table}[h!]
% \centering
% \begin{tabular}{ >{\bf}r | l}
% Part number & \\
% Center wavelength & 1310 nm \\
% -3dB Bandwidth & 100 nm \\
% Drive frequency & 80 MHz \\
% Drive power & 1.5 W \\
% Price & 2, at \$1500 each \\
% \end{tabular}
% \caption{Specifications for the acousto-optic modulator.}
% \end{table} 

\subsection{RF generation and driving}

The AOMs must be driven by an 80 MHz and an 80.25 MHz RF signal in order to produce the beat frequency derived in Section \ref{sec:aom_carrier}. A frequency synthesizer, built by former Micromechanics Group student Stanley Hong \cite{hong}, uses a 1 GHz clock source to synthesize a 80.25 MHz signal and an 80 MHz signal. The mixed difference between these signals, a 250 KHz beat signal, is also generated, as it is necessary for later signal processing steps.

Two RF amplifiers, (Mini Circuits, United States. Part No: ZHL-3A) amplify the RF signals +29.5 dBm to +32 dBm (approximately 1.5 Watts), the maximum drive power of the AOMs.

The 1 GHz clock is generated by a small integrated oscillator (Fox Electronics, United States. Part No: FXOâ€“PC536R-1000). An output of +13 dBm was measured at $50\Omega$, sufficient for driving the frequency synthesizer. This oscillator and the small amount of supporting electrical hardware required was packaged in an enclosure and connected to a BNC output.

%% Schematic of 1Ghz oscillator
\begin{figure}[h!]
\centering
\includegraphics[width=0.6\textwidth]{Images/Schematics/1ghzclock_2.png}
\caption[Schematic of the 1 GHz clock.]{Schematic of the 1 GHz clock. J1 is the 1 GHz output.}
\end{figure}

\subsection{Reference path}
\label{sec:reference_path}

%% TODO: Image of reference path setup

The reference path uses an adjustable focus fiber optic coupled collimator, and focuses it onto a mounted aluminum front surface mirror. A mirror was used instead of a retroreflector as its greater parallelism resulted in higher coupling efficiency than was achievable with a retroreflector, despite the increased difficulty in alignment. The collimator was used with an FC/APC fiber optic terminator in order to reduce back reflections. %, however, the $8^{\circ}$ face angle of FC/APC fiber connector reduced coupling efficiency dramatically. To fix this, a hybrid fiber patch cable was used, so that an FC/PC connector would connect to the collimator.
This setup was simulated with Zemax optical design software, as shown in Figure \ref{fig:reference_zemax}, predicting a single mode fiber coupling efficiency of -0.55 dB.% (as opposed to the -22.56 dB efficiency calculated with an FC/APC connector.)

\begin{figure}[h!]
\centering
\includegraphics[width=0.8\textwidth]{Images/Zemax/RP-raytrace.png}
\caption[Zemax raytrace simulation of reference path.]{Zemax raytrace simulation of reference path. Note that the vertical axis is enlarged by 20$\times$, and that the mirror is represented by duplicating and reversing the optical system about the center.\label{fig:reference_zemax}}
\end{figure}

The mirror was mounted on a non-motorized, single axis micropositioning stage, allowing the reference path length to be adjusted so that it matches the distance to the sample path objective focal point.

%One consequence of using a retroreflector instead of a mirror is that the polarization of the beam is changed. This could be cause for concern if a future iteration of this system was ued for polarization sensitive imaging, however, the optical polarization is effectively randomized due to strain and compression in the optical fiber already.

\subsection{Sample path objective}

A graded index (GRIN) lens (Thorlabs, United States. Part No: GRIN2313A) was used to focus light onto the sample under examination. The GRIN lens is sold as a package that can be assembled to focus to a desired distance. An 8 degree angled face is used to reduce back-reflection. This was fixed in place with a UV cured optical adhesive (Norland Products, United States. Part No: NOA68).

\begin{figure}[h!]
\centering
\includegraphics[width=1.0\textwidth]{Images/System/grin_angled.png}
\caption[The GRIN lens assembly.]{The GRIN lens assembly. \em{Image adapted from Thorlabs.} \label{fig:grin_assembly}}
\end{figure}

The physical distance from the GRIN objective lens to the tissue under examination, referred to as the working distance ($W$), is determined by balancing the conveniences of having a large space between the lens and the sample, the achievable penetration depth, the amplitude of scattered light, and in some cases the transverse resolution.

%% scattered light amplitude

The solid angle $\Omega$ subtended by the GRIN lens is equal to

\begin{equation}
\Omega = 2 \pi (1 - \cos{\theta})
\end{equation}

where $\theta = \arctan{\frac{r_{\mathrm{grin}}}{W}}$.

\begin{equation}
\Omega = 2 \pi \left(1 - \sqrt{\frac{W^2}{W^2 + r_{\mathrm{grin}}^2}} \right)
\end{equation}

Assuming an isotropic scatterer, the fraction of optical power that will be recollected by the GRIN lens is equal to $\frac{\Omega}{4 \pi}$. As the GRIN lens used in this thesis has a radius of 0.9 mm, this fraction may be written numerically as follows.

\begin{equation}
\frac{1}{2} \left( 1 - \sqrt{\frac{W^2}{W^2 + 0.81}} \right)
\end{equation}

A plot of this scattering loss for working distances between 0 and 5 mm is shown in Figure \ref{fig:wd}.

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/System/grin_scattering2.png}
\caption[Light lost to an isotropic scatterer, as a function of working distance.]{Light lost to an isotropic scatterer, as a function of working distance. \label{fig:wd}}
\end{figure}

A working distance of approximately 2.5 mm was chosen, as it provided the minimum sufficient distance between the lens and sample, while avoiding unnecessary scattering loss or resolution limitations.

%As previously discussed in Section~\ref{sec:principles_oct}, the axial resolution limit for a diffraction limited optical system is dependent on the numeric aperture (NA) of the optical system, given by $\mathrm{NA} = r_{\mathrm{grin}}/W$. A higher NA results in a smaller diffraction limit, so it can be seen that a longer working distance implies a lower transverse resolution. 

% \begin{equation} \label{eq:tres2_c}
%  \delta_x = 0.61 \frac{\lambda}{NA}
%  \end{equation}

% \begin{equation} \label{eq:tres2}
% \delta_x = 0.61 \frac{\lambda}{NA} \approx 1.22 \frac{\lambda W}{1.8 \mathrm{mm}} \approx W \cdot 0.888 \cdot 10^{-3} \;\;
% \end{equation}

%A working distance of 2 mm was chosen, resulting in a maximum numeric aperture of $1.8/(2W) \approx 0.45$. As this is far greater than the NA of the fiber (0.14) that is focused on the opposite side of the GRIN lens, this does not limit transverse resolution. %This numeric aperture corresponds to a transverse resolution limit of $\delta_x = 4.77$ microns.

% A working distance of 2 mm was choosen, resulting in a transverse resolution limit of 1.78 microns, and a reflection loss of -13.6 dB (again, assuming an isotropic scaterrer).

\section{Sample alignment apparatus}

%% solidworks images and mechanical design discussion

% \begin{figure}[h!]
% \centering
% \caption[3D model of the mechanical alignment apparatus.]{A 3D model of the mechanical alignment apparatus. 1) Vertical adjustment slider. 2) Horizontal adjustment slider. 3) Angular adjustment slider. 4) GRIN objective lens. 5) Z-axis piezo stage. 6) Digital microscope.}
% \end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.59\textwidth]{Images/Alignment/new_d_2_ann.png}
\\[0.8em]
\includegraphics[width=0.69\textwidth]{Images/Photographs/DSCF1696_an.jpg}
\caption[3D model and photograph of the mechanical alignment apparatus.]{A 3D model and a  photograph of the mechanical alignment apparatus. 1) Vertical adjustment slider. 2) Horizontal adjustment slider. 3) Angular adjustment slider. 4) GRIN objective lens. 5) Z-axis piezo stage. 6) Digital microscope. 7)~Microscope illumination source.\label{fig:alignment_overview}}
\end{figure}


The sample alignment apparatus, pictured in Figure~\ref{fig:alignment_overview}, is a mechanical device designed to accomplish several goals:

\begin{itemize}
	\item Securely hold the GRIN objective lens
	\item Move the GRIN objective along the direction of the optical axis with a precise motorized stage
	\item Allow the GRIN objective lens to be rotated a certain angle around its focal point
	\item Allow adjustments for height and horizontal distance
	\item Provide a visible alignment aid beam
	\item Hold a small digital microscope for visual inspection of alignment
\end{itemize}

\subsection{Mechanical device for adjusting angle and position}

\begin{figure}[h!]
\centering
\includegraphics[width=0.4\textwidth]{Images/System/angle_a.png}
\caption[Side view of the alignment apparatus.]{Side view of the alignment apparatus, with arrows indicating mechanisms for adjusting position and angle.}
\end{figure}

To control the angle of the optical axis, the z-axis stage is mounted on a horizontal aluminum cantilever, with two circularly concentric slots cut out. By screwing the stage mounting block into the slots, the angle can be adjusted around a fixed point. When the system is configured such that it is focused on this point, the operator is able to change the angle of axial movement without changing the current focal point, a helpful feature for alignment.

% \begin{figure}[h!]
% \centering
% \includegraphics[width=1.0\textwidth]{Images/Alignment/horizontal_part.png}
% \caption{The horizontal cantilever piece, with two slots allowing for angular adjustment.}
% \end{figure}

The cantilever part was designed in SolidWorks and then milled on a CNC machine in the Edgerton Center Student Shop. An L-shaped part was designed to hold the horizontal cantilever. Later, a vertical part was added to enable continuous adjustment of cantilever height and to allow for a higher maximum height, necessary as a result of the clearance requirements of the 2D transverse stage. These parts were milled by hand at the Edgerton Center Student Shop.

\subsection{Piezo motor stage for axial movement}

% \begin{figure}[h!]
% \centering
% \includegraphics[width=0.48\textwidth]{Images/System/z-stage.jpg}
% \caption{The piezo motor stage with controller.}
% \end{figure}

% \begin{table}[h!]
% \centering
% \begin{tabular}{ >{\bf}r | l}
% Part number & CONEX-AG-LS25-27P\\
% Travel range & 27mm  \\
% Repeatability & 200 nm \\
% Speed & 0.4mm / sec \\
% Minimum incremental motion & 200nm \\
% Price & \$1725 \\
% \end{tabular}
% \caption{Specifications for the axial piezo motor stage.}
% \end{table}

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/Photographs/DSCF1714_an.jpg}
\caption[Photograph of the piezo motion stage.]{A photograph of the piezo motion stage. 1) Piezoelectric motorized stage. 2) `L'-backet to mount piezo stage. 3) `S'-bracket to mount GRIN lens. 4) GRIN lens `V'-clamp.}
\end{figure}

To control z-axis scanning, a piezo-electric motorized stage was used (Newport, Inc., United States. Part No: CONEX-AG-LS25-27P). This stage uses an ``inchworm'' drive method to control motion in discrete steps. Quadrature position encoders with closed loop feedback provide repeatable movements of up to a manufacturer specification of 200 nm.

Unfortunately, this stage also has some drawbacks for an OCT application. Though the closed loop feedback allows for the stage to move precisely to any location, the speed of movement is not consistent. As a result, it is necessary to either collect data pixel-by-pixel or to re-interpolate the data collected based on the actual position of the stage as it scans. These methods, and their advantages and drawbacks, are discussed further in the signal processing section, Section~\ref{sec:sig_proc}.

To capture information about the real time position of the stage, two approaches were used. The first involved repeatedly querying the stage driver over a serial connection. While this was straightforward to accomplish and within the bounds of normal operation of the stage, it did not provide high enough time resolution of the position of the stage. The second approach required adding analog output from the stage encoders that could be captured directly by the analog-to-digital converter simultaneously with the interferometry signal. This involved extracting the quadrature encoder signal from the controller circuit board and soldering additional BNC output.

The piezo stage was mounted to the angle adjustment apparatus by fabricating a custom mounting plate designed for the unique hole spacing on the stage. The plate is also designed as an `L' shape, so that the GRIN lens points in the radial direction of the angle adjustment arc.

% \begin{figure}[h!]
% \centering
% \includegraphics[width=0.48\textwidth]{Images/Alignment/angle_bracket2.png}
% \includegraphics[width=0.48\textwidth]{Images/Alignment/angle_bracket.jpg}
% \caption{This angled bracket mounts the piezo-motor stage to the horizontal cantilever shown above. The image on the right shows the bracket prior to the addition of stabilization bolts.}
% \end{figure}

\subsection{Mounting the fiber and GRIN lens}

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/Alignment/close_up.png}
\caption[A close up view of the GRIN objective mounting apparatus.]{A close up view of the GRIN objective mounting apparatus. 1)~GRIN objective. 2)~Brass extension rod used to lower the GRIN lens. 3)~V-clamp. 4)~Digital microscope. 5)~Optical fiber (truncated in image.) 6)~`S' bracket.}
\end{figure}

To hold the GRIN lens at a sufficient distance from the stage with minimal bulk, a small brass rod was adhered with a UV-cured optical adhesive to the outer glass tube in the GRIN lens assembly. A V-clamp was used to firmly hold the brass rod in place. A custom `S'-shaped mounting bracket was designed and milled to connect to the piezo stage, allow the V-clamp to be mounted, and also to allow the digital microscope to be installed such that it could image the focal point of the GRIN lens. Note that without the brass extension rod, the focal point of the GRIN lens would be blocked from the view of the microscope by the V-clamp and supporting hardware. The narrow profile of the brass tube and GRIN lens also allow the objective to be positioned more easily near the sample under examination.

\subsection{Digital microscope for visual alignment}

%% Image of final microscope

\begin{figure}[h!]
\centering
\includegraphics[width=1.0\textwidth]{Images/Photographs/DSCF1699_an.jpg}
\caption[An overview of the digital alignment microscope.]{An overview of the digital alignment microscope. 1) LED illumination source. 2) Mounting bracket (position and angle adjustment). 3) Lens tube. 4) USB Webcam CCD.}
\end{figure}

In order to aid the alignment process, an optical microscope with a digital CCD viewfinder was constructed to observe the region imaged by the OCT process.

The design required a relatively large working distance and correspondingly low numerical aperture in order to allow the microscope to have an angle as close to the optical axis of the OCT objective lens as possible.

A CCD sensor from a USB web camera (Microsoft, United States. Part No: Xbox Live Vision) was used, due to its compact size, low cost, and use of the standard USB Video Class protocol, compatible with MATLAB and other image capture applications. As the CCD has a quite small size, approximately 3x5mm (actual dimension specifications are not available), a low magnification was sufficient.

A MATLAB script was used to optimize the working distance, while keeping the overall optical length within reasonable limits, and while working with a set of easily obtainable lenses, using a simple paraxial lens approximation. From this MATLAB program, a Zemax simulation model was created, using accurate models of the real lenses from which the microscope would be constructed.

\begin{figure}[h!]
\centering
\includegraphics[width=0.6\textwidth]{Images/Zemax/microscope_layout_2.png}
\caption{A raytrace diagram of the microscope layout, simulated in Zemax.\label{fig:microscope_raytrace}}
\end{figure}

The microscope is composed of three lenses in two groups: a 15 mm spherical doublet (Edmund Optics, United States. Part No: 45209) and a 20 mm spherical singlet (Thorlabs, United States. Part No: LA1074). The lenses are mounted in a $1/2$ inch diameter lens tube. A 4 mm diameter aperture, laser cut from opaque acrylic, was used to further reduce spherical aberrations, improving image quality at the expense of light intensity. A raytrace diagram of the microscope is shown in Figure~\ref{fig:microscope_raytrace}, and the predicted point spread function in Figure~\ref{fig:microscope_psf}.

\begin{figure}[h!]
\centering
\includegraphics[width=0.6\textwidth]{Images/Zemax/microscope_psf_2.png}
\caption[The point spread function of the microscope, as simulated in Zemax.]{The point spread function of the microscope, as simulated in Zemax.\label{fig:microscope_psf}}
\end{figure}

The performance was tested by imaging a backlit 1961 USAF Resolution Test Target, demonstrating that the microscope is capable of resolving features as small as 7.8 \micron~wide, and has a field of view of 1.16 mm $\times$ 0.87 mm, for a magnification of approximately 4$\times$.

\begin{figure}[h!]
\centering
\includegraphics[width=0.7\textwidth]{Images/Microscope/target2.png}
\caption{An image of a 1961 USAF Resolution Test Target, captured using the digital microscope. \label{fig:usaf}}
\end{figure}

Due to the nature of the microscope's intended application, the sample is not illuminated by transillumination but instead by viewing the light scattered by the sample from a bright LED source mounted near the end of the microscope. While the performance of this microscope is too limited for most imaging applications (in particular, the contrast is quite poor, as evidenced by the ``haze'' around the bright regions in Figure \ref{fig:usaf}), it is sufficient for performing basic alignment of the FO-DOCM system and is therefore sufficient for the system design requirements.

\subsection{Visible laser for assisting visual alignment}

%% Image of laser

The spectral responsivity of a silicon photosensor, like that used in the digital microscope CCD, falls sharply above 1000 nm. As the optical source in this system is centered at 1310 nm, it is difficult to view the spot produced by the focused infrared light. To solve this, a second optical source can be coupled into the GRIN lens.

For this purpose, an inexpensive 650 nm laser diode is used. The output of the diode is collimated and coupled into an optical fiber, which can be attached through a FC/APC connector directly to the GRIN lens. This produces a highly visible laser spot that is helpful for aligning the start of an OCT scan.

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/System/alignment_laser.jpg}
\caption[An image of the visible laser spot on cochlear tissue.]{An image of the visible laser spot on cochlear tissue, captured by the digital microscope.}
\end{figure}

%% Image of laser spot

\section{X-Y stage for sample movement}

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/Photographs/DSCF1722_an.jpg}
\caption[The transverse X-Y stepper motor stage.]{The transverse X-Y stepper motor stage. 1)~Laser-cut mounting platform, with aluminum stand-offs. 2)~Prior H101 two-axis stage. 3)~Laser-cut mounting plate.}
\end{figure}

To move in the transverse plane, the sample is placed on a stepper motor driven two axis stage (Prior Scientific Ltd., Japan. Part No: H101BX). While this stage is designed for use with a conventional upright microscope, custom mounting hardware was designed and fabricated to allow it to stand freely. The stage is driven by a stepper controller, which accepts commands over a serial connection (Prior Scientific Ltd., Japan. Part No: H128V). The stage has a 1 \micron~step size, but poor repeatability, making it suitable only for 2D scanning in the x-z or y-z planes.

% \begin{figure}[h!]
% \centering
% \includegraphics[width=0.75\textwidth]{Images/Alignment/x-y-mount.png}
% \caption[The mounting plate that allows the Prior H101B microscope stage to stand freely.]{The mounting plate that allows the Prior H101B microscope stage to stand freely. This was fabricated by laser cutting acrylic.}
% \end{figure}

% \begin{table}[h!]
% \centering
% \begin{tabular}{ >{\bf}r | l}
% Part number & Prior H101BX \\
% Travel range & 115 x 77 mm \\
% Incremental step size & 40 nm \\
% Bidirectional repeatability & 800 nm \\
% Motor type & 200 Series Stepper \\
% \end{tabular}
% \caption{Specifications for the X-Y stage.}
% \end{table} 


\section{Light detection and analog-to-digital conversion}

The light is detected by a photodiode with an integrated transconductance amplifier (New Focus, Inc., United States. Part No: 2117-FC). This photodetector has a sensitivity range of 800-1700 nm and a transimpedance gain of up to $18.8 \times 10^6 \;\; \mathrm{V}/\mathrm{A}$, with responsivity near $1 \mathrm{A}/\mathrm{W}$ at 1310 nm. %Full specifications are detailed in Table \ref{table:pd}.

As the interference carrier signal is set at 500 KHz, the analog photodiode low-pass and high-pass filters in the photodetector are configured to pass signals between 300 KHz and 1 MHz.

%\begin{figure}[h!]
%\centering
%\includegraphics[width=0.6\textwidth]{Images/System/pd.jpg}
%\caption{The Newport New Focus 2117-FC photodetector.}
%\end{figure}

% \begin{table}[h!]
% \centering
% \begin{tabular}{ >{\bf}r | l}
% Part number & \\
% Wavelength range & 800 - 1700 nm \\
% Transimpedance gain & $18.8 \times 10^6 \mathrm{V/A}$ \\
% Noise equivalent power & 0.4 $mathrm{pW}/\sqrt{\mathrm{Hz}}$ \\
% Price & \$1390 \\
% \end{tabular}
% \caption{Specifications for the photo detector. \label{table:pd}}
% \end{table}

The output from the photodiode is digitized by using a two input PCI DAC/ADC card (Interface Co., Japan. Part No: PCI-3525). Multiple DAC/ADC cards are daisy chained together to be able to capture greater than two signals simultaneously. This is useful, as up to five signals may be of interest to capture: the photodiode output, the RF synthesizer difference frequency, the acoustic stimulus signal, and the two $z$-stage quadrature encoders.

%The source for this program may be found in Appendix \ref{app:pci3525}

To capture these signals, a program was written in C to communicate with the DAC/ADC. As the photodiode filters frequencies above 1 MHz, a sampling frequency of 2.5 MHz was chosen to avoid frequency aliasing. The capture program allows for application-specific flexibility and may be used with imaging interfaces in MATLAB and Python.

% \begin{table}[h!]
% \centering
% \begin{tabular}{ >{\bf}r | l}
% Part number & PCI-3525 \\
% Bit depth & 12 \\
% Sampling rate & 10 MS/s \\
% \end{tabular}
% \caption{Specifications for the DAC. \label{table:dac}}
% \end{table}

\section{Signal processing}
\label{sec:sig_proc}

The FO-DOCM system is capable of performing two distinct tasks. The first is image generation, creating a static 2D or 3D image of the sample. The second is motion analysis, capturing information about the movement of one specific area of a sample. The primary difference in these two tasks is that motion analysis requires a segment of data to be sampled from one stationary point while image generation can use a continually scanning axis.

%% Mostly MATLAB and source code here. Theory behind the processing is introduced in Chapter 1

\subsection{Image generation}
\label{sec:imgen}

An overview of the signal processing steps necessary for continuous scan image generation from acquired data, for a single z-axis sweep, is shown in Figure \ref{fig:imagegen}.

\begin{figure}[h!]
\centering
\includegraphics[width=0.65\textwidth]{Images/Background/image_analysis.png}
\caption{A block diagram overview of the steps necessary for image generation. \label{fig:imagegen}}
\end{figure}

First, the captured signal is bandpassed using a FIR digital filter with a smaller passband than is practical with analog filters. Next, the Hilbert transform is used to extract the envelope of the signal. Using data from the quadrature encoders of the z-axis stage, this envelope is reinterpolated to be a function of space instead of time. As the envelope is much more slowly varying than the original 500 KHz signal, it can be decimated to the size desired for the final image. This process is repeated for each captured line to assemble the full 2D or 3D image. A function to implement these steps was written in MATLAB.

\subsection{Motion analysis}
\label{sec:motion_analysis_2}

An overview of the signal processing steps necessary to perform on acquired data to estimate motion parameters, for a single pixel, is shown in Figure \ref{fig:motion_analysis_block_diagram}.

\begin{figure}[h!]
\centering
\includegraphics[width=1.0\textwidth]{Images/Background/motion_process.png}
\caption{A block diagram overview of the steps necessary for motion analysis. \label{fig:motion_analysis_block_diagram}}
\end{figure}

This process is the same as that derived mathematically in Section \ref{sec:sigproc_mo_anal}. First, the Hilbert transform is used to estimate the instantaneous phase of the photodiode interference signal, and of the 250 KHz reference output from the RF synthesizer. The difference between the 500 KHz phase signal and twice the 250 KHz phase signal is periodically varying when the phase of the 500 KHz signal varies periodically, as is the case when light is scattered from a moving sample excited at a known frequency. A sinusoid of this known frequency is fit by linear least squares to this periodically varying phase, as a noise-resistant method of estimating both the amplitude and the phase offset of the oscillation. This process provides an estimate of the motion parameters at a single point in the sample. This process can be repeated for as many points are desired, or for an entire array of points in order to generate an image of motion amplitude and phase in a sample. This analysis is also implemented as a function in MATLAB.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% SECTION 2 PERFORMANCE %%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Theoretical performance predictions}
\label{sec:theory_res}

\subsection{Axial resolution}
\label{sec:axial_res}

Axial resolution is limited by the coherence length of the optical source, as derived in Equation \ref{eq:ares} in Chapter 1 as

\begin{equation} \label{eq:ares2}
\delta_z = l_c = \frac{2 \ln{2}}{\pi} \frac{\lambda_0^2}{\Delta \lambda} \; .
\end{equation}

The specifications for the optical source used in this project were not precisely equivalent to the measured performance of the actual source. The actual -3dB bandwidth was 86.3 nm, whereas the specified bandwidth was 100 nm. Additionally, the actual power output was 7.00 mW, whereas the specified power was 10 mW. The slightly smaller bandwidth results in an axial resolution of 9.94 \micron, inferior to the prediction in Section~\ref{sec:principles_oct}. The optical spectrum measurements also showed that bandwidth, and therefore resolution, is not adversely impacted by any other optical components in the system. %The results of optical spectrum measurement at the output of several key components in the OCT system are shown in Figure \ref{fig:osa}.

% Optical spectrum analyzer graph
% \begin{figure}[h!]
% \centering
% \includegraphics[width=0.9\textwidth]{Images/System/osa.png}
% \caption[Optical spectrum analyzer results for the outputs of four critical parts in the OCT system.]{Optical spectrum analyzer results for the outputs of four critical parts in the OCT system. Due to a different experimental setup, the power levels measured in retro-reflector collimation are not representative of the actual system, and are clearly heavily affected by the noise floor of the optical spectrum analyzer. \label{fig:osa}}
% \end{figure}

From the optical power spectral density, the point spread function can be numerically predicted by calculating the Fourier transform, as derived in Section~\ref{sec:principles_oct}. Using the Discrete Fourier Transform, the measured optical spectrum analyzer results may be used to estimate the axial point spread function. The result of this analysis is shown in Figure~\ref{fig:axial_psf_matlab}.

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/Background/theoretical_axial_psf3.png}
\caption[Theoretical axial point spread function.]{Theoretical axial point spread function. Computed from optical spectrum analyzer measurements of the SLD source.\label{fig:axial_psf_matlab}}
\end{figure}

\subsection{Transverse resolution}
\label{sec:transverse_res}

As previously discussed in Section~\ref{sec:transverse_background}, the maximum achievable resolution is determined by the objective optics used to focus the light. Light emitted from the optical fiber propagates as a Gaussian beam, so by solving for the evolution of the parameters of the Gaussian beam, the minimum beam waist may be calculated. The complex beam parameter $q$, defined in Equation~\ref{eq:qparam}, may be used to describe the Gaussian beam. Light is emitted from an optical fiber with infinite radius of curvature, and with a waist defined by the fiber mode diameter, so the initial $q$ parameter of the beam is the purely imaginary value

\begin{equation}
q_0 = i \frac{\pi w_0^2}{\lambda} \; .
\end{equation}

From Equation~\ref{eq:q1}, the complex beam parameter after propagation is

\begin{equation}
q_1 = \frac{\sin (\sqrt{A} l_2) (A l_1 n_0^2
   (l_3+q_0)-1)-\sqrt{A} n_0 \cos (\sqrt{A}
   l_2) (l_1+l_3+q_0)}{A n_0^2 (l_3+q_0) \sin
   (\sqrt{A} l_2)-\sqrt{A} n_0 \cos (\sqrt{A}
   l_2)}
   \label{eq:q1} \; .
\end{equation}

The mode field diameter of the SMF-28e+ optical fiber used by the FO-DOCM system is 9.2 \micron. For the GRIN lens, $\sqrt{A} = 0.327 \; \mathrm{mm}^{-1}$, $l_2 = 4.42 \; \mathrm{mm}$, and $n_0 = 1.5916$. From these values, the numerical value of the new complex beam parameter is calculated to be

% \begin{equation}
% \frac{(4.176 - 0.089 I) - 1.758 l_3}{(0.242 - 0.051 I) -  l_3}
% \end{equation}

\begin{equation}
q_1 = \frac{(0.242 - 0.051 i) l_1 + (3.692 + 0.012 i) - l_1 l_3 + 0.242325 l_3}{(0.242 -0.051 i) - l_3} \; \mathrm{mm}
\end{equation}

\noindent where $l_3$ is the distance from the fiber to the GRIN lens and $l_1$ is the working distance from the GRIN lens to the focal point. To achieve, a working distance of approximately 2 mm, the GRIN lens was assembled approximately 2 mm away from the optical fiber. Using this value for $l_3$, and Equation~\ref{eq:wz}, the new beam diameter is 

\begin{equation}
\begin{aligned}
 w_1 & = \sqrt{\frac{-\lambda}{\pi \operatorname{Im} (1/q_1})v} \\
 & = 0.047 \sqrt{(4.176 - 1.758 l_1)^2 + (0.0123 - 0.051 l_1)^2}
\end{aligned}
\end{equation}

\noindent which has a minimum at a working distance of $l_1 = 2.374$ mm away from the GRIN objective lens. At this distance, the beam radius at $1/e^2$ intensity was $5.07$ \micron. This corresponds to a transverse FWHM resolution of $5.97$ \micron.

% The maximum achievable resolution in the transverse direction, as previously discussed in Chapter 1, is determined by the diffraction limit \cite{hecht}. The FWHM size of the Airy disc produced by diffraction is

% \begin{equation} \label{eq:tres2_b}
% d = 0.51 \lambda \frac{1}{\mathrm{NA}} \; .
% \end{equation}

% In this case, the fiber side NA, defined by the size of the fiber mode, is significantly smaller than the sample side NA, so its impact predominates. For the system described above, this evaluates to a diffraction limit of 4.77 \micron~in air.

Using Zemax with lens files provided by the manufacturer of the GRIN lens, a more accurate simulation was created of the objective lens performance, shown in Figure~\ref{grin_raytrace}. When an object was on the optical axis, as is the case when emerging from an optical fiber, Zemax found the $1/e^2$ Gaussian beam radius to be 5.08 \micron, almost identical to the value calculated theoretically above.

\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Images/Zemax/GRO-raytrace2.png}
\caption[A Zemax raytrace showing the path of light through the GRIN lens.]{A Zemax raytrace showing the geometric ray optics approximation of the path of the Gaussian beam through the GRIN lens. Light emerges from the SMF-28e+ single mode fiber (NA = 0.14) on the left, and is focused to a point on the right.\label{grin_raytrace}}
\end{figure}

% \begin{figure}[h!]
% \centering
% \includegraphics[width=0.75\textwidth]{Images/Zemax/grin_psf_2.png}
% \caption[The PSF of the GRIN lens objective system.]{The PSF of the GRIN lens objective system. The FWHM width is 5.16 \micron, which shows that it is very nearly diffraction limited.\label{fig:grin_psf}}
% \end{figure}

% \begin{figure}[h!]
% \centering
% \includegraphics[width=0.75\textwidth]{Images/Zemax/GRO-encircledenergy.png}
% \caption[A graph of the energy encircled at a given radius for the actual GRIN lens]{A graph of the energy encircled at a given radius for the actual GRIN lens. The second line shows encircled energy for an ideal lens. This shows performance that is very nearly diffraction limited.}
% \end{figure}
